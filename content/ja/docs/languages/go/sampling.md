---
title: サンプリング
weight: 80
---

[Sampling](/docs/concepts/sampling/) is a process that restricts the amount of
spans that are generated by a system. The exact sampler you should use depends
on your specific needs, but in general you should make a decision at the start
of a trace, and allow the sampling decision to propagate to other services.

[`Sampler`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#Sampler)は、次のように[`WithSampler`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#WithSampler)オプションを使用してトレーサープロバイダーに設定できます。

```go
provider := trace.NewTracerProvider(
    trace.WithSampler(trace.AlwaysSample()),
)
```

[`AlwaysSample`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#AlwaysSample)と[`NeverSample`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#NeverSample)は説明不要の値です。`AlwaysSample`はすべてのスパンがサンプリングされることを意味し、`NeverSample`はスパンがサンプリングされないことを意味します。
開始時や開発環境では、`AlwaysSample`を使用してください。 `AlwaysSample` means that every span is sampled,
while `NeverSample` means that no span is sampled. When you're getting started,
or in a development environment, use `AlwaysSample`.

Other samplers include:

- [`TraceIDRatioBased`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#TraceIDRatioBased)は、サンプラーに与えられた割合に基づいてスパンの一部をサンプリングします。0.5を設定すると、すべてのスパンの半分がサンプリングされます。
  If you set .5, half of all the spans are sampled.
- [`ParentBased`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#ParentBased)は、スパンの親に基づいて異なる動作をするサンプラーデコレーターです。スパンに親がない場合、デコレートされたサンプラーがスパンの親に基づいてサンプリング決定を行うために使用されます。デフォルトでは、`ParentBased`はサンプリングされた親を持つスパンをサンプリングし、サンプリングされなかった親を持つスパンはサンプリングしません。 If the span has no parent, the decorated sampler is used to make
  sampling decision based on the parent of the span. By default, `ParentBased`
  samples spans that have parents that were sampled, and doesn't sample spans
  whose parents were not sampled.

デフォルトでは、トレーサープロバイダーは`AlwaysSample`サンプラーを使用した`ParentBased`サンプラーを使用します。

本番環境では、`TraceIDRatioBased`サンプラーを使用した`ParentBased`サンプラーの使用を検討してください。
