---
title: 采样
weight: 80
---

[Sampling](/docs/concepts/sampling/) is a process that restricts the amount of
spans that are generated by a system. The exact sampler you should use depends
on your specific needs, but in general you should make a decision at the start
of a trace, and allow the sampling decision to propagate to other services.

你可以使用 [`WithSampler`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#WithSampler)
选项在 Tracer Provider 上设置一个
[`Sampler`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#Sampler)，如下所示：

```go
provider := trace.NewTracerProvider(
    trace.WithSampler(trace.AlwaysSample()),
)
```

[`AlwaysSample`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#AlwaysSample)
和
[`NeverSample`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#NeverSample)
顾名思义，`AlwaysSample` 表示对每个 span 都会进行采样，而 `NeverSample` 表示不对任何 span 进行采样。 `AlwaysSample` means that every span is sampled,
while `NeverSample` means that no span is sampled. When you're getting started,
or in a development environment, use `AlwaysSample`.

其他采样器还包括：

- [`TraceIDRatioBased`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#TraceIDRatioBased)：它按一定比例采样 span，这个比例根据提供给采样器的数值决定。例如设置为 0.5 表示采样 50% 的 span。
  If you set .5, half of all the spans are sampled.
- [`ParentBased`](https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace#ParentBased)： 是一种采样器装饰器，它的行为会根据当前 span 是否有父 span，以及父 span 的采样状态来决定。如果 span 没有父级，那么就使用传入的默认采样器来决定是否采样；如果有父 span，默认情况下：若父 span 被采样了，则当前 span 也被采样；若父 span 没被采样，则当前 span 也不会被采样。 If the span has no parent, the decorated sampler is used to make
  sampling decision based on the parent of the span. By default, `ParentBased`
  samples spans that have parents that were sampled, and doesn't sample spans
  whose parents were not sampled.

默认情况下，Tracer Provider 将 `ParentBased` 采样器和 `AlwaysSample` 采样器结合在一起使用。

在生产环境中，建议将 `ParentBased` 采样器与 `TraceIDRatioBased` 采样器搭配使用。
